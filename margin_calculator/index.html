<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>범용 쇼핑몰 마진율 계산기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem 0;
        }
        .calculator-container {
            max-width: 800px;
            width: 100%;
        }
        .card {
            border-radius: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #343a40;
            color: white;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            padding: 1.5rem;
        }
        .form-label {
            font-weight: 600;
        }
        .input-group-text {
            min-width: 80px;
            justify-content: center;
        }
        .form-switch .form-check-label {
            cursor: pointer;
        }
        #results h2 {
            font-size: 1.5rem;
            color: #343a40;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #e9ecef;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-item span:first-child {
            font-weight: 500;
            color: #495057;
        }
        .result-item span:last-child {
            font-weight: 700;
            font-size: 1.1rem;
            color: #212529;
        }
        .profit {
            color: #0d6efd !important;
        }
        .loss {
            color: #dc3545 !important;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="card">
            <div class="card-header text-center">
                <h1>범용 쇼핑몰 마진율 계산기</h1>
            </div>
            <div class="card-body p-4 p-md-5">
                <div id="calculator-form">
                    <!-- 판매 방식 선택 -->
                    <div class="mb-4">
                        <label class="form-label">1. 판매 방식 선택</label>
                        <div class="d-flex">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="shippingType" id="self-shipping" value="self" checked>
                                <label class="form-check-label" for="self-shipping">직접 배송</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="shippingType" id="fulfillment" value="fulfill">
                                <label class="form-check-label" for="fulfillment">풀필먼트 이용</label>
                            </div>
                        </div>
                    </div>

                    <!-- 가격 정보 -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="cost-price" class="form-label">2. 매입가 (공급가)</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="cost-price" placeholder="0">
                                <span class="input-group-text">원</span>
                            </div>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" id="cost-vat-included" checked>
                                <label class="form-check-label" for="cost-vat-included">부가세 포함</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="selling-price" class="form-label">3. 판매가</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="selling-price" placeholder="0">
                                <span class="input-group-text">원</span>
                            </div>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" id="selling-vat-included" checked>
                                <label class="form-check-label" for="selling-vat-included">부가세 포함</label>
                            </div>
                        </div>
                    </div>

                    <!-- 플랫폼 정보 -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="platform" class="form-label">4. 플랫폼 선택</label>
                            <select class="form-select" id="platform">
                                <option value="custom" data-fee="">직접 입력</option>
                                <option value="naver" data-fee="4.5">네이버 스마트스토어 (평균)</option>
                                <option value="coupang" data-fee="10">쿠팡 마켓플레이스 (평균)</option>
                                <option value="gmarket" data-fee="12">G마켓/옥션 (평균)</option>
                                <option value="11st" data-fee="12">11번가 (평균)</option>
                                <option value="cafe24" data-fee="3">자사몰 (PG사 평균)</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="platform-fee" class="form-label">플랫폼 수수료</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="platform-fee" placeholder="0">
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                    </div>

                    <!-- 비용 정보 -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6" id="self-shipping-fields">
                            <label for="shipping-cost" class="form-label">5. 배송비</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="shipping-cost" placeholder="0">
                                <span class="input-group-text">원</span>
                            </div>
                             <label for="packaging-cost" class="form-label mt-3">포장 부자재 비용</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="packaging-cost" placeholder="0">
                                <span class="input-group-text">원</span>
                            </div>
                        </div>
                        <div class="col-md-6" id="fulfillment-fields" style="display: none;">
                            <label for="fulfillment-fee" class="form-label">5. 풀필먼트 수수료</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="fulfillment-fee" placeholder="0">
                                <span class="input-group-text">원</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="other-costs" class="form-label">6. 기타 비용</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="other-costs" placeholder="0">
                                <span class="input-group-text">원</span>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="my-5">

                <!-- 계산 결과 -->
                <div id="results">
                    <h2 class="text-center mb-4">계산 결과</h2>
                    <div class="row">
                        <div class="col-md-6 mb-4">
                             <h5 class="mb-3">수익/비용 분석</h5>
                            <div class="result-item">
                                <span>정산 예정 금액</span>
                                <span id="result-payout">0 원</span>
                            </div>
                            <div class="result-item">
                                <span>최종 수익 (마진)</span>
                                <span id="result-profit">0 원</span>
                            </div>
                            <div class="result-item">
                                <span>마진율</span>
                                <span id="result-margin-rate">0 %</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5 class="mb-3">부가세 분석</h5>
                            <div class="result-item">
                                <span>매출 부가세</span>
                                <span id="result-output-vat">0 원</span>
                            </div>
                            <div class="result-item">
                                <span>매입 부가세</span>
                                <span id="result-input-vat">0 원</span>
                            </div>
                            <div class="result-item">
                                <span>납부 예상 부가세</span>
                                <span id="result-vat-payable">0 원</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Element References
        const shippingTypeRadios = document.querySelectorAll('input[name="shippingType"]');
        const selfShippingFields = document.getElementById('self-shipping-fields');
        const fulfillmentFields = document.getElementById('fulfillment-fields');
        const platformSelect = document.getElementById('platform');
        const platformFeeInput = document.getElementById('platform-fee');

        // --- Event Listeners ---

        // 1. 판매 방식 선택 (직접배송/풀필먼트) UI 변경
        shippingTypeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'self') {
                    selfShippingFields.style.display = 'block';
                    fulfillmentFields.style.display = 'none';
                } else {
                    selfShippingFields.style.display = 'none';
                    fulfillmentFields.style.display = 'block';
                }
                calculate(); // Re-calculate when shipping type changes
            });
        });

        // 2. 플랫폼 선택 시 수수료 자동 입력
        platformSelect.addEventListener('change', (e) => {
            const selectedOption = e.target.options[e.target.selectedIndex];
            const fee = selectedOption.getAttribute('data-fee');
            platformFeeInput.value = fee || '';
            calculate(); // Re-calculate when platform changes
        });
        
        // 3. 모든 입력 필드에 대한 실시간 계산 이벤트 리스너
        const inputFields = document.querySelectorAll('input[type="number"], input[type="checkbox"], input[type="radio"], select');
        inputFields.forEach(field => {
            field.addEventListener('input', calculate);
            field.addEventListener('change', calculate);
        });


        // --- Main Calculation Logic ---
        function calculate() {
            // 1. Get all input values
            const shippingType = document.querySelector('input[name="shippingType"]:checked').value;
            let costPrice = parseFloat(document.getElementById('cost-price').value) || 0;
            const costVatIncluded = document.getElementById('cost-vat-included').checked;
            let sellingPrice = parseFloat(document.getElementById('selling-price').value) || 0;
            const sellingVatIncluded = document.getElementById('selling-vat-included').checked;
            const platformFeeRate = parseFloat(document.getElementById('platform-fee').value) || 0;
            const shippingCost = parseFloat(document.getElementById('shipping-cost').value) || 0;
            const packagingCost = parseFloat(document.getElementById('packaging-cost').value) || 0;
            const fulfillmentFee = parseFloat(document.getElementById('fulfillment-fee').value) || 0;
            const otherCosts = parseFloat(document.getElementById('other-costs').value) || 0;

            // 2. VAT Calculation
            const outputVat = sellingVatIncluded ? sellingPrice - (sellingPrice / 1.1) : sellingPrice * 0.1;
            const inputVat = costVatIncluded ? costPrice - (costPrice / 1.1) : costPrice * 0.1;
            const vatPayable = outputVat - inputVat;

            const sellingPriceExVat = sellingVatIncluded ? sellingPrice / 1.1 : sellingPrice;
            const costPriceExVat = costVatIncluded ? costPrice / 1.1 : costPrice;

            // 3. Core Margin Calculation
            const platformFeeAmount = sellingPrice * (platformFeeRate / 100);
            const payoutAmount = sellingPrice - platformFeeAmount;

            let totalVariableCosts;
            if (shippingType === 'self') {
                totalVariableCosts = costPrice + platformFeeAmount + shippingCost + packagingCost + otherCosts;
            } else { // 'fulfill'
                totalVariableCosts = costPrice + platformFeeAmount + fulfillmentFee + otherCosts;
            }
            
            const profit = sellingPrice - totalVariableCosts;
            const marginRate = sellingPrice > 0 ? (profit / sellingPrice) * 100 : 0;

            // 4. Update UI
            updateResults({
                payout: payoutAmount,
                profit: profit,
                marginRate: marginRate,
                outputVat: outputVat,
                inputVat: inputVat,
                vatPayable: vatPayable
            });
        }

        // --- UI Update Function ---
        function updateResults(results) {
            document.getElementById('result-payout').textContent = formatCurrency(results.payout);
            
            const profitElement = document.getElementById('result-profit');
            profitElement.textContent = formatCurrency(results.profit);
            profitElement.classList.toggle('profit', results.profit > 0);
            profitElement.classList.toggle('loss', results.profit < 0);

            document.getElementById('result-margin-rate').textContent = `${results.marginRate.toFixed(2)} %`;
            
            document.getElementById('result-output-vat').textContent = formatCurrency(results.outputVat);
            document.getElementById('result-input-vat').textContent = formatCurrency(results.inputVat);
            document.getElementById('result-vat-payable').textContent = formatCurrency(results.vatPayable);
        }

        function formatCurrency(value) {
            return `${Math.round(value).toLocaleString('ko-KR')} 원`;
        }

        // Initial calculation on page load
        window.addEventListener('load', calculate);

    </script>
</body>
</html>
