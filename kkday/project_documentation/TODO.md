# KKday 크롤링 시스템 - 상세 작업 목록

## 🎯 Phase 1: 핵심 모듈 전환 (진행중)

### ✅ 완료된 작업
- [x] `./src/config.py` - Klook → KKday 기본 설정 변경 완료
- [x] `./src/utils/location_learning.py` - import 경로 `klook.src.config` → `kkday.src.config` 수정 완료
- [x] `./src/utils/city_manager.py` - 도시명 별칭 매핑 테이블 정리 및 "청도": "칭따오" 추가 완료
- [x] `./src/utils/file_handler.py` - 함수명, URL, 주석 KKday용으로 변경 완료 (CSS 셀렉터 보류)
- [x] `./src/scraper/crawler.py` - 클래스명 `KKdayCrawler`, 함수명 모든 KKday용 변경 완료
- [x] `./README.md` - 프로젝트 문서화 및 개발 가이드라인 작성 완료
- [x] `./PRD.md` - 제품 요구사항 명세서 작성 완료

### 🎉 2025-09-07 추가 완료 작업
- [x] `./src/scraper/url_manager.py` - **완전 KKday 전환 완료** ✨
  - [x] 함수명 변경: `is_valid_klook_url()` → `is_valid_kkday_url()`
  - [x] 함수명 변경: `normalize_klook_url()` → `normalize_kkday_url()`  
  - [x] 함수명 변경: `extract_activity_id()` → `extract_product_id()`
  - [x] URL 패턴: KLOOK → KKday 도메인 및 경로 패턴 완전 변경
  - [x] 페이지네이션: 화살표 방식 → 숫자 클릭 방식으로 완전 전환
  - [x] CSS 셀렉터: KKday 전용 셀렉터 매핑 완료
  - [x] USER_AGENT 설정: `get_random_user_agent()` 연동 완료
  - [x] 전체 코드 검증: KLOOK 잔여 코드 0개 확인
- [x] **방콕 크롤링 시스템 준비 완료** - 페이지네이션 문제 해결로 실행 가능 상태

### 🔄 진행중인 작업
**현재 작업 없음 - 다음 단계 준비 중**

### ⏳ 대기중인 작업  
**우선순위 1: 시스템 검증 및 테스트** ⭐ (먼저 실행)
  - [ ] **KKday 메인 목록 페이지 분석** - https://www.kkday.com/ko/product/productlist
    - [ ] 전체 상품 목록 구조 분석
    - [ ] 페이지네이션 실제 동작 방식 확인
    - [ ] 필터링 및 정렬 옵션 분석
    - [ ] 상품 카드 셀렉터 정확성 검증
  - [ ] **방콕 실제 크롤링 테스트** - url_manager.py 수정 효과 검증
  - [ ] 페이지네이션 동작 확인 (숫자 클릭 방식)
  - [ ] URL 수집 및 데이터 추출 정확성 검증

**우선순위 2: 남은 핵심 모듈 전환** (검증 후 실행)
  - [ ] `./src/scraper/driver_manager.py` - KKday 웹사이트 대응 작업
    - [ ] 라인 136-138: 주석 및 URL `https://www.klook.com` → `https://www.kkday.com` 변경
    - [ ] 라인 156-161: 검색창 CSS 셀렉터 KKday용으로 변경
    - [ ] 라인 198-202: 검색 버튼 CSS 셀렉터 KKday용으로 변경

  - [ ] `./src/scraper/parsers.py` - 데이터 파싱 로직 KKday 대응
    - [ ] Klook 관련 함수명/클래스명 → KKday로 변경
    - [ ] 상품 정보 추출 CSS 셀렉터 KKday용으로 전면 교체
    - [ ] 가격, 평점, 리뷰수 등 모든 데이터 필드 셀렉터 업데이트

  - [ ] `./src/scraper/ranking.py` - 순위 시스템 KKday 대응  
    - [ ] Klook 관련 함수명 → KKday로 변경
    - [ ] 순위 관련 CSV 파일 경로 `klook_` → `kkday_` 변경
    - [ ] 순위 데이터 구조 KKday 형식에 맞게 조정

  - [ ] KKday 하이라이트 수집 함수 구현 (다중 셀렉터 방식)
  - [ ]KKday 투어형태 수집 함수 구현 (정보테이블 + 옵션명 + 상품명)
  - [ ]KKday 언어/소요시간 아이콘 기반 수집 로직 구현
  - [ ]KKday 카테고리 breadcrumb 수집 로직 구현
  - [ ]crawler.py 메인 로직 KKday용 수정
  - [ ]driver_manager.py의 검색/네비게이션 로직 수정
  - [ ]테스트 및 디버깅
  - [ ]README.md 업데이트

### 🔧 CSS 셀렉터 수집 대기 목록
**우선순위 1: 기본 검색 기능**
- [ ] KKday 메인 페이지 검색창 셀렉터
- [ ] KKday 검색 버튼 셀렉터  
- [ ] KKday 검색 결과 페이지 상품 링크 셀렉터

**우선순위 2: 상품 데이터 추출**
- [ ] 상품명 추출 셀렉터
- [ ] 가격 정보 셀렉터  
- [ ] 평점 셀렉터
- [ ] 리뷰수 셀렉터
- [ ] 카테고리/태그 셀렉터

**우선순위 3: 이미지 및 부가 정보**  
- [ ] 메인 이미지 URL 셀렉터
- [ ] 썸네일 이미지 URL 셀렉터
- [ ] 상품 설명/하이라이트 셀렉터
- [ ] 언어/투어형태 등 부가 정보 셀렉터

## 🎯 Phase 2: Jupyter 노트북 업데이트

### 📓 노트북 파일 전환 작업
- [ ] `./kkday_crawler.ipynb` - 메인 크롤러 노트북
  - [ ] Klook 관련 코드 → KKday로 일괄 변경
  - [ ] import 구문에서 `KlookCrawler` → `KKdayCrawler` 변경
  - [ ] 실행 예제 도시명 및 URL KKday용으로 수정
  - [ ] 출력 메시지 및 로그 KKday로 변경

- [ ] `./kkday_Sitemap_Collector.ipynb` - 사이트맵 URL 수집기
  - [ ] 사이트맵 URL `klook.com/sitemap.xml` → `kkday.com/sitemap.xml` 변경
  - [ ] URL 패턴 매칭 규칙 KKday 형식으로 수정
  - [ ] 수집된 URL 저장 경로 `klook_urls.csv` → `kkday_urls.csv` 변경

- [ ] `./kkday_Sitemap_Crawler.ipynb` - 사이트맵 기반 크롤러
  - [ ] 사이트맵 파싱 로직 KKday 구조 대응
  - [ ] 크롤링 대상 URL 필터링 KKday 패턴으로 수정  
  - [ ] 데이터 저장 구조 KKday 형식으로 통일

- [ ] `./kkday_ad_link generator.ipynb` - 제휴링크 생성기
  - [ ] 제휴링크 URL 패턴 `klook.com` → `kkday.com` 변경
  - [ ] 제휴 파트너 코드 KKday용으로 교체
  - [ ] 링크 생성 규칙 KKday API 스펙에 맞게 수정

## 🎯 Phase 3: 통합 테스트 및 검증

### 🧪 시스템 테스트
- [ ] **단위 테스트**: 각 모듈별 개별 기능 검증
  - [ ] `test_config.py` - 도시 정보 및 설정 테스트
  - [ ] `test_crawler.py` - 크롤링 엔진 테스트  
  - [ ] `test_parsers.py` - 데이터 파싱 정확성 테스트
  - [ ] `test_file_handler.py` - CSV/이미지 저장 테스트

- [ ] **통합 테스트**: 전체 시스템 연동 검증
  - [ ] 서울 3개 상품 크롤링 테스트 (성공률 100%)
  - [ ] 도쿄 5개 상품 크롤링 테스트 (성공률 95% 이상)
  - [ ] 방콕 10개 상품 크롤링 테스트 (이미지 다운로드 포함)
  - [ ] 파리 20개 상품 크롤링 테스트 (대용량 데이터 처리)

### 📊 성능 검증
- [ ] **속도 테스트**: 페이지당 처리시간 5초 이내 달성
- [ ] **메모리 테스트**: 100개 상품 크롤링 시 2GB 이내 사용
- [ ] **안정성 테스트**: 6시간 연속 실행 안정성 검증  
- [ ] **오류 복구 테스트**: 네트워크 오류 시 자동 재시도 검증

### 🔍 품질 검증  
- [ ] **데이터 품질**: 필수 필드 추출률 95% 이상 달성
- [ ] **이미지 품질**: 이미지 다운로드 성공률 90% 이상 달성
- [ ] **CSV 검증**: 데이터 형식 및 구조 일관성 검증
- [ ] **중복 제거**: 해시 기반 중복 상품 처리 정확성 검증

## 📋 작업 진행 규칙 (Chain of Thought 기법 적용)

### 🔄 고도화된 워크플로우
1. **작업 선택**: TODO 리스트에서 하나씩 순차 선택
2. **문제 분석**: 해결해야 할 핵심 문제 정의 (현재 상황 → 목표 상황)
3. **계획 수립**: 1단계→2단계→3단계 구체적 실행 계획 제시
4. **가정 사항**: 기존 코드 동작, 의존성, 제약사항 명시
5. **컨텍스트 제공**: 관련 파일의 핵심 코드 스니펫 포함
6. **사용자 승인**: 계획 검토 후 승인/수정 요청
7. **코드 적용**: 승인된 계획에 따라 실제 구현
8. **자가 검증**: CODING_STANDARDS.md의 체크리스트 적용
9. **통합 테스트**: 관련 모듈과의 연동 확인
10. **완료 표시**: 체크리스트 ✅ 표시 및 다음 작업 이동

### 📋 작업 계획서 템플릿
```markdown
## 작업 계획서: [파일명]
**문제**: [현재 상황과 해결해야 할 문제]
**목표**: [달성하려는 최종 상태]
**단계**: 
1. [1단계 작업 내용]
2. [2단계 작업 내용] 
3. [3단계 작업 내용]
**가정**: [작업 시 전제 조건들]
**의존성**: [관련된 다른 파일/함수]
**검증**: [완료 후 확인 방법]
```

### ✅ 완료 기준
- [ ] **코드 정확성**: Klook 관련 키워드 0개 남김 (`grep -i klook` 결과 없음)
- [ ] **동작 검증**: 수정된 함수/클래스 정상 import 및 실행
- [ ] **데이터 일관성**: 기존 데이터 구조 및 형식 유지
- [ ] **문서 동기화**: 주석 및 docstring KKday로 통일

### 🚨 주의사항  
- **CSS 셀렉터**: 실제 KKday 웹사이트 검증 후 적용
- **기능 호환성**: 기존 크롤링 기능 100% 유지
- **데이터 백업**: 수정 전 중요 파일 백업
- **테스트 우선**: 주요 변경 시 즉시 테스트 실행

## 📊 진행 현황 대시보드

### 전체 진행률 (2025-09-07 업데이트)
- **Phase 1**: 🎉 **85% 완료** (8/10 작업) - url_manager.py 완전 전환으로 대폭 진전
- **Phase 2**: 0% 완료 (0/4 작업)  
- **Phase 3**: 0% 완료 (0/12 작업)
- **전체**: 🚀 **31% 완료** (8/26 작업)

### 🎯 다음 작업 일정 (논리적 순서로 재정리)

**🥇 1단계: 검증 우선 (먼저 실행)**
1. 🔥 **KKday 메인 목록 페이지 분석** - https://www.kkday.com/ko/product/productlist 구조 분석
2. 🔥 **방콕 크롤링 실제 테스트** - url_manager.py 수정 효과 즉시 검증

**🥈 2단계: 개발 (검증 결과 반영)**  
3. 🔥 **driver_manager.py 완료** - 기본 웹사이트 접근 기능 완성  
4. 🔥 **parsers.py 완료** - 핵심 데이터 추출 기능 완성
5. ⚡ **ranking.py 완료** - 순위 시스템 완성

**🥉 3단계: 통합 (최종 검증)**
6. 🧪 **통합 테스트** - 전체 시스템 검증

### 🏆 오늘의 성과
- ✨ **url_manager.py 완전 KKday 전환** - 페이지네이션 문제 해결
- 🎯 **방콕 크롤링 시스템 준비 완료** - 실행 가능 상태 달성
- 📈 **Phase 1 진행률 15% 향상** (70% → 85%)

---

**문서 버전**: v1.1  
**최종 업데이트**: 2025-09-07 (url_manager.py 완전 전환 완료)
**담당자**: mikael
