ğŸ’¡ ì•„í•˜! êµ¬ì¡°ë¥¼ ì´í•´í–ˆìŠµë‹ˆë‹¤!

  ì¹˜ì•™ë§ˆì´ì˜ ìƒˆë¡œìš´ ê²€ìƒ‰ ì‹œìŠ¤í…œì€ 2ë‹¨ê³„ êµ¬ì¡°ë„¤ìš”!

  ğŸ” ìƒˆë¡œìš´ ê²€ìƒ‰ í”Œë¡œìš° íŒŒì•…

  1ë‹¨ê³„: ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½ í˜ì´ì§€

  - URL: https://www.myrealtrip.com/search?q=%EC%B9%98%EC%95%99%EB%A7%88%EC%9D%B4
  - ë‚´ìš©: ì—¬ëŸ¬ ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ë¯¸ë¦¬ë³´ê¸°
  - íˆ¬ì–´ãƒ»í‹°ì¼“ ì„¹ì…˜: "536ê°œ ë”ë³´ê¸°" ë²„íŠ¼ ì¡´ì¬

  2ë‹¨ê³„: ëª©ë¡í˜ì´ì§€

  - "536ê°œ ë”ë³´ê¸°" ë²„íŠ¼ í´ë¦­ â†’ ì‹¤ì œ ëª©ë¡í˜ì´ì§€ë¡œ ì´ë™
  - ì—¬ê¸°ì„œë¶€í„° ìŠ¤í¬ë¡¤ ë˜ëŠ” í˜ì´ì§€ë„¤ì´ì…˜ ë°©ì‹

  ğŸ› ï¸ í•„ìš”í•œ ëŒ€ì‘ ë°©ì•ˆ

  A. ìƒˆë¡œìš´ ê²€ìƒ‰ í”Œë¡œìš° í•¨ìˆ˜

  def navigate_to_product_list_new_system(driver, city_name):
      """ìƒˆë¡œìš´ ê²€ìƒ‰ ì‹œìŠ¤í…œì—ì„œ ìƒí’ˆ ëª©ë¡í˜ì´ì§€ë¡œ ì´ë™"""

      # 1. ê²€ìƒ‰ ì‹¤í–‰ (ê¸°ì¡´ ë°©ì‹)
      perform_new_search(driver, city_name)

      # 2. "ë”ë³´ê¸°" ë²„íŠ¼ ì°¾ê¸° ë° í´ë¦­
      more_buttons = [
          "//button[contains(text(), 'ë”ë³´ê¸°')]",
          "//a[contains(text(), 'ë”ë³´ê¸°')]",
          "//button[contains(text(), 'ê°œ ë”ë³´ê¸°')]",
          "//span[contains(text(), 'íˆ¬ì–´ãƒ»í‹°ì¼“')]/following::button[contains(text(), 'ë”ë³´ê¸°')]"
      ]

      for selector in more_buttons:
          try:
              button = driver.find_element(By.XPATH, selector)
              if button.is_displayed() and button.is_enabled():
                  print(f"âœ… '{button.text}' ë²„íŠ¼ ë°œê²¬, í´ë¦­ ì¤‘...")
                  button.click()
                  time.sleep(3)
                  return True
          except:
              continue

      print("âŒ ë”ë³´ê¸° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
      return False

  B. ì ì‘í˜• ê²€ìƒ‰ ì‹œìŠ¤í…œ

  def adaptive_search_and_navigate(driver, city_name):
      """ë„ì‹œë³„ ê²€ìƒ‰ ë°©ì‹ ìë™ ì„ íƒ"""

      # 1. ê¸°ì¡´ ë°©ì‹ ì‹œë„
      try:
          perform_new_search(driver, city_name)  # ê¸°ì¡´ í•¨ìˆ˜

          # ë°”ë¡œ ëª©ë¡í˜ì´ì§€ì¸ì§€ í™•ì¸
          product_links = driver.find_elements(By.CSS_SELECTOR, "a[href*='/products/']")
          if len(product_links) >= 10:
              print(f"âœ… {city_name}: ê¸°ì¡´ ì‹œìŠ¤í…œ (ë°”ë¡œ ëª©ë¡í˜ì´ì§€)")
              return "direct_list"

      except Exception as e:
          print(f"âŒ ê¸°ì¡´ ë°©ì‹ ì‹¤íŒ¨: {e}")

      # 2. ìƒˆë¡œìš´ ë°©ì‹ ì‹œë„ (ë”ë³´ê¸° ë²„íŠ¼)
      if navigate_to_product_list_new_system(driver, city_name):
          print(f"âœ… {city_name}: ìƒˆë¡œìš´ ì‹œìŠ¤í…œ (ë”ë³´ê¸° ë²„íŠ¼ ê²½ìœ )")
          return "button_navigation"

      print(f"âš ï¸ {city_name}: ë‘ ë°©ì‹ ëª¨ë‘ ì‹¤íŒ¨")
      return "failed"

  ğŸ¯ ê·¸ë£¹ 11 ì—…ë°ì´íŠ¸ëœ ì„¤ê³„

  í•µì‹¬ ê¸°ëŠ¥

  1. ğŸ” ê²€ìƒ‰ ë°©ì‹ ê°ì§€: ì§ì ‘ ëª©ë¡ vs ë”ë³´ê¸° ë²„íŠ¼ í•„ìš”
  2. ğŸ”˜ ë”ë³´ê¸° ë²„íŠ¼ ì²˜ë¦¬: "536ê°œ ë”ë³´ê¸°" ê°™ì€ ë²„íŠ¼ ìë™ í´ë¦­
  3. ğŸ”„ ì ì‘í˜• ë„¤ë¹„ê²Œì´ì…˜: ë„ì‹œë³„ ìµœì  ê²½ë¡œ ì„ íƒ
  4. ğŸ“Š í˜¸í™˜ì„± ìœ ì§€: ê¸°ì¡´ ê·¸ë£¹ë“¤ê³¼ ì™„ì „ í˜¸í™˜

  ì´ì œ ì •í™•í•œ êµ¬ì¡°ë¥¼ íŒŒì•…í–ˆìœ¼ë‹ˆ ê·¸ë£¹ 11ì„ êµ¬í˜„í•´ë³´ì‹œê² ì–´ìš”?

  ë”ë³´ê¸° ë²„íŠ¼ê¹Œì§€ ê³ ë ¤í•œ ì™„ì „í•œ ì ì‘í˜• ì‹œìŠ¤í…œì´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤! ğŸš€

> ëª©ë¡í˜ì´ì´ì§€ê°€ ë‚˜ì˜¤ë©´ ë¬´í•œ ìŠ¤í¬ë¡¤ í˜•ì‹ìœ¼ë¡œ ìƒí’ˆëª©ë¡ì´ ë³´ì„

â— ğŸ¯ ì™„ì „í•œ í”Œë¡œìš° íŒŒì•… ì™„ë£Œ!

  ì´ì œ ì¹˜ì•™ë§ˆì´ì˜ ìƒˆë¡œìš´ ì‹œìŠ¤í…œ ì „ì²´ êµ¬ì¡°ë¥¼ ì´í•´í–ˆìŠµë‹ˆë‹¤!

  ğŸ“± ì¹˜ì•™ë§ˆì´ ìƒˆë¡œìš´ í¬ë¡¤ë§ í”Œë¡œìš°

  1. ê²€ìƒ‰ ì‹¤í–‰
     â†“
  2. ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½ í˜ì´ì§€ (ì—¬ëŸ¬ ì¹´í…Œê³ ë¦¬ ë¯¸ë¦¬ë³´ê¸°)
     â†“
  3. "536ê°œ ë”ë³´ê¸°" ë²„íŠ¼ í´ë¦­
     â†“
  4. ì‹¤ì œ ëª©ë¡í˜ì´ì§€ (ë¬´í•œ ìŠ¤í¬ë¡¤ í˜•ì‹)
     â†“
  5. ìŠ¤í¬ë¡¤ ë‹¤ìš´í•˜ë©° ìƒí’ˆ ìˆ˜ì§‘

  ğŸ› ï¸ ê·¸ë£¹ 11: ì™„ì „í•œ ì ì‘í˜• í¬ë¡¤ë§ ì‹œìŠ¤í…œ

  # =============================================================================
  # ğŸ†• ê·¸ë£¹ 11: ë§ˆì´ë¦¬ì–¼íŠ¸ë¦½ ìƒˆë¡œìš´ ê²€ìƒ‰ ì‹œìŠ¤í…œ ëŒ€ì‘ (2025-07-31)
  # - 2ë‹¨ê³„ ê²€ìƒ‰ í”Œë¡œìš°: ê²€ìƒ‰ â†’ ë”ë³´ê¸° ë²„íŠ¼ â†’ ë¬´í•œìŠ¤í¬ë¡¤ ëª©ë¡
  # - ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ê³¼ ìƒˆë¡œìš´ ìŠ¤í¬ë¡¤ ë°©ì‹ ëª¨ë‘ ì§€ì›
  # - ë„ì‹œë³„ ìë™ ê°ì§€ ë° ì ì‘í˜• í¬ë¡¤ë§
  # =============================================================================

  def detect_search_system_type(driver, city_name):
      """ê²€ìƒ‰ ì‹œìŠ¤í…œ íƒ€ì… ê°ì§€"""
      current_url = driver.current_url

      # URL íŒ¨í„´ìœ¼ë¡œ 1ì°¨ íŒë³„
      if '/search?q=' in current_url:
          # ë”ë³´ê¸° ë²„íŠ¼ì´ ìˆëŠ”ì§€ í™•ì¸
          more_buttons = driver.find_elements(By.XPATH, "//button[contains(text(), 'ë”ë³´ê¸°')]")
          if more_buttons:
              return 'two_step_scroll'  # 2ë‹¨ê³„ ìŠ¤í¬ë¡¤ ë°©ì‹
          else:
              return 'direct_scroll'    # ì§ì ‘ ìŠ¤í¬ë¡¤ ë°©ì‹

      elif '/offers?' in current_url or '/experiences?' in current_url:
          return 'pagination'  # ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜

      else:
          return 'unknown'

  def navigate_to_scroll_list(driver, city_name):
      """ìƒˆë¡œìš´ ì‹œìŠ¤í…œì—ì„œ ë¬´í•œìŠ¤í¬ë¡¤ ëª©ë¡í˜ì´ì§€ë¡œ ì´ë™"""

      print(f"ğŸ” {city_name}: ë”ë³´ê¸° ë²„íŠ¼ ì°¾ëŠ” ì¤‘...")

      # ë”ë³´ê¸° ë²„íŠ¼ ì…€ë ‰í„°ë“¤
      more_button_selectors = [
          "//button[contains(text(), 'ë”ë³´ê¸°')]",
          "//button[contains(text(), 'ê°œ ë”ë³´ê¸°')]",
          "//span[contains(text(), 'íˆ¬ì–´')]/ancestor::section//button[contains(text(),
  'ë”ë³´ê¸°')]",
          "//span[contains(text(), 'í‹°ì¼“')]/ancestor::section//button[contains(text(),
  'ë”ë³´ê¸°')]",
          "[data-testid*='more'] button",
          ".show-more-button"
      ]

      for selector in more_button_selectors:
          try:
              if selector.startswith('//'):
                  buttons = driver.find_elements(By.XPATH, selector)
              else:
                  buttons = driver.find_elements(By.CSS_SELECTOR, selector)

              for button in buttons:
                  if button.is_displayed() and button.is_enabled():
                      button_text = button.text.strip()
                      if 'ë”ë³´ê¸°' in button_text:
                          print(f"âœ… '{button_text}' ë²„íŠ¼ ë°œê²¬, í´ë¦­ ì¤‘...")

                          # ë²„íŠ¼ì´ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
                          driver.execute_script("arguments[0].scrollIntoView(true);", button)
                          time.sleep(1)

                          # í´ë¦­
                          button.click()
                          time.sleep(random.uniform(3, 5))

                          # ëª©ë¡í˜ì´ì§€ ë¡œë”© ëŒ€ê¸°
                          WebDriverWait(driver, 10).until(
                              lambda d: len(d.find_elements(By.CSS_SELECTOR,
  "a[href*='/products/']")) > 5
                          )

                          print(f"âœ… ë¬´í•œìŠ¤í¬ë¡¤ ëª©ë¡í˜ì´ì§€ ì´ë™ ì™„ë£Œ")
                          return True

          except Exception as e:
              continue

      print(f"âŒ ë”ë³´ê¸° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
      return False

  def scroll_and_collect_infinite(driver, city_name, target_count=50):
      """ë¬´í•œìŠ¤í¬ë¡¤ ë°©ì‹ìœ¼ë¡œ ìƒí’ˆ ìˆ˜ì§‘"""

      print(f"ğŸ”„ {city_name}: ë¬´í•œìŠ¤í¬ë¡¤ ìƒí’ˆ ìˆ˜ì§‘ ì‹œì‘ (ëª©í‘œ: {target_count}ê°œ)")

      collected_urls = []
      last_count = 0
      scroll_attempts = 0
      max_scroll_attempts = 20

      while len(collected_urls) < target_count and scroll_attempts < max_scroll_attempts:

          # í˜„ì¬ í˜ì´ì§€ì˜ ìƒí’ˆ URL ìˆ˜ì§‘
          current_urls = collect_product_urls_from_page(driver)

          # ì¤‘ë³µ ì œê±°í•˜ë©° ëˆ„ì 
          for url in current_urls:
              if url not in collected_urls:
                  collected_urls.append(url)

          print(f"    ğŸ“Š í˜„ì¬ ìˆ˜ì§‘: {len(collected_urls)}ê°œ / ëª©í‘œ: {target_count}ê°œ")

          # ëª©í‘œ ë‹¬ì„± ì‹œ ì¢…ë£Œ
          if len(collected_urls) >= target_count:
              break

          # ë” ì´ìƒ ìƒˆë¡œìš´ ìƒí’ˆì´ ë¡œë”©ë˜ì§€ ì•Šìœ¼ë©´ ì¢…ë£Œ
          if len(collected_urls) == last_count:
              scroll_attempts += 1
              print(f"    âš ï¸ ìƒˆë¡œìš´ ìƒí’ˆ ì—†ìŒ (ì‹œë„ {scroll_attempts}/{max_scroll_attempts})")
          else:
              scroll_attempts = 0  # ìƒˆë¡œìš´ ìƒí’ˆ ë°œê²¬ ì‹œ ì¹´ìš´í„° ë¦¬ì…‹

          last_count = len(collected_urls)

          # ìŠ¤í¬ë¡¤ ë‹¤ìš´
          print(f"    ğŸ”½ ìŠ¤í¬ë¡¤ ë‹¤ìš´...")
          driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")
          time.sleep(random.uniform(2, 4))  # ë¡œë”© ëŒ€ê¸°

      final_urls = collected_urls[:target_count]
      print(f"âœ… {city_name}: ë¬´í•œìŠ¤í¬ë¡¤ ìˆ˜ì§‘ ì™„ë£Œ ({len(final_urls)}ê°œ)")

      return final_urls

  def adaptive_crawl_system(driver, city_name, target_count=50):
      """ğŸ¯ ì™„ì „ ì ì‘í˜• í¬ë¡¤ë§ ì‹œìŠ¤í…œ"""

      print(f"ğŸš€ {city_name}: ì ì‘í˜• í¬ë¡¤ë§ ì‹œì‘")

      # 1. ê²€ìƒ‰ ì‹œìŠ¤í…œ íƒ€ì… ê°ì§€
      system_type = detect_search_system_type(driver, city_name)
      print(f"ğŸ” ê°ì§€ëœ ì‹œìŠ¤í…œ: {system_type}")

      # 2. ì‹œìŠ¤í…œ íƒ€ì…ë³„ í¬ë¡¤ë§ ì‹¤í–‰
      if system_type == 'two_step_scroll':
          # ìƒˆë¡œìš´ 2ë‹¨ê³„ ìŠ¤í¬ë¡¤ ì‹œìŠ¤í…œ
          if navigate_to_scroll_list(driver, city_name):
              return scroll_and_collect_infinite(driver, city_name, target_count)
          else:
              print(f"âŒ 2ë‹¨ê³„ ìŠ¤í¬ë¡¤ ì‹¤í–‰ ì‹¤íŒ¨")
              return []

      elif system_type == 'direct_scroll':
          # ì§ì ‘ ìŠ¤í¬ë¡¤ ì‹œìŠ¤í…œ
          return scroll_and_collect_infinite(driver, city_name, target_count)

      elif system_type == 'pagination':
          # ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ ì‹œìŠ¤í…œ
          print(f"ğŸ“„ ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ ì‹œìŠ¤í…œ ì‚¬ìš©")
          return crawl_with_full_pagination(city_name, target_count)

      else:
          # ì•Œ ìˆ˜ ì—†ëŠ” ì‹œìŠ¤í…œ - ìˆœì°¨ì  ì‹œë„
          print(f"â“ ì•Œ ìˆ˜ ì—†ëŠ” ì‹œìŠ¤í…œ - ìˆœì°¨ ì‹œë„")

          # ë¨¼ì € 2ë‹¨ê³„ ìŠ¤í¬ë¡¤ ì‹œë„
          if navigate_to_scroll_list(driver, city_name):
              return scroll_and_collect_infinite(driver, city_name, target_count)

          # ì‹¤íŒ¨í•˜ë©´ ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ ì‹œë„
          try:
              return crawl_with_full_pagination(city_name, target_count)
          except:
              print(f"ğŸš¨ ëª¨ë“  ë°©ì‹ ì‹¤íŒ¨")
              return []

  print("âœ… ê·¸ë£¹ 11 ì™„ë£Œ: ì™„ì „ ì ì‘í˜• í¬ë¡¤ë§ ì‹œìŠ¤í…œ!")
  print("ğŸ”§ ì§€ì› ê¸°ëŠ¥:")
  print("   - 2ë‹¨ê³„ ìŠ¤í¬ë¡¤ ì‹œìŠ¤í…œ (ê²€ìƒ‰ â†’ ë”ë³´ê¸° â†’ ë¬´í•œìŠ¤í¬ë¡¤)")
  print("   - ì§ì ‘ ìŠ¤í¬ë¡¤ ì‹œìŠ¤í…œ")
  print("   - ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ ì‹œìŠ¤í…œ")
  print("   - ìë™ ê°ì§€ ë° ì ì‘í˜• ì‹¤í–‰")
  print("ğŸ¯ ëª¨ë“  ë„ì‹œì˜ ì‹œìŠ¤í…œ ë³€í™”ì— ëŒ€ì‘ ê°€ëŠ¥!")