# 마이리얼트립 크롤링 시스템 개발 프로젝트

## 📊 프로젝트 개요
안정적이고 확장 가능한 대용량 크롤링 시스템을 구축하여, 중단 없이 모든 페이지의 상품 정보를 수집하고 체계적으로 저장하는 시스템입니다.

## ✅ 완료된 작업 (2025-07-21)

### 1순위: 상태 관리 시스템 구축 ✅
- **config/crawler_meta.json**: 크롤링 메타데이터 저장
- **config/completed_urls.log**: 완료된 URL 목록 저장  
- **5개 핵심 함수 추가**:
  - `load_crawler_state()` - 상태 복원
  - `save_crawler_state()` - 상태 저장
  - `save_batch_data()` - 배치 처리 저장 (연속성 확보)
  - `filter_new_urls()` - 새로운 URL 필터링
  - `create_image_filename()` - 이미지 파일명 생성
- **테스트 완료**: 모든 함수 정상 작동 확인

### 2순위: 그룹 3 정찰 단계 강화 ✅
- **페이지네이션 정보 분석**: `analyze_pagination()` 함수 추가
- **다음 페이지 버튼 확인**: `check_next_button()` 함수 추가
- **크롤링 계획 수립**: `generate_crawling_plan()` 함수 추가
- **정찰 결과 보고**: `report_reconnaissance_results()` 함수 추가
- **개선된 URL 수집**: `collect_page_urls_enhanced()` 함수 추가
- **실제 테스트 완료**: 푸켓 페이지에서 정찰 기능 검증

### 3순위: 데이터 연속성 문제 완전 해결 ✅
- **이미지 폴더 초기화 문제 수정**: 그룹 2에서 `shutil.rmtree` 주석 처리
- **CSV 데이터 연속성 확보**: `save_batch_data()` 함수에서 추가 방식으로 변경
- **이미지 파일명 중복 방지**: `download_image()` 함수 매개변수 `image_number`로 변경
- **브라우저 재부팅 시 연속성 보장**: 전역 이미지 카운터 시스템 구현
- **Windows 경로 처리 개선**: `os.path.join()` 사용으로 안정성 향상

### 4순위: 브라우저 재부팅 시스템 검증 ✅
- **재부팅 간격 테스트**: 2-3개마다 재부팅으로 설정하여 실제 테스트
- **오류 복구 확인**: WebDriverException 발생 시 자동 재부팅 및 복구
- **페이지 복귀 검증**: 재부팅 후 정확한 페이지로 복귀 확인
- **데이터 구조 개선**: 불필요한 상품번호 컬럼 제거
- **CONFIG 정리**: 미사용 설정 삭제로 코드 명확성 향상
- **다중 도시 테스트**: 푸켓, 바르셀로나에서 재부팅 시스템 검증 완료

### 푸켓 정찰 결과 (실제 데이터)
- **총 상품 수**: 423개 발견
- **페이지네이션**: 점(dot) 형태 버튼 방식 ✅
- **페이지 구조**: 18페이지 (1~17페이지: 24개씩, 18페이지: 15개)
- **URL 유형**: Products (18개) + Offers (6개) = 24개/페이지
- **크롤링 전략**: 다중 페이지 순회 방식
- **예상 소요 시간**: 약 211분 (423개 상품 × 30초)

### 데이터 연속성 완전 확보 ✅
- ✅ **중단 시 재시작 가능**: 완료된 URL 자동 건너뛰기
- ✅ **중복 방지 시스템**: URL 및 이미지 파일명 중복 방지
- ✅ **배치 처리**: I/O 효율성 증대 + 연속성 확보
- ✅ **계층 구조 데이터 관리**: data/{대륙}/{국가}/{도시}/
- ✅ **이미지 연속 번호**: HKT_001.jpg, HKT_002.jpg, HKT_003.jpg...
- ✅ **세션 간 연속성**: 새 세션에서도 기존 데이터 보존

## 🚀 다음 작업 우선순위

### 5순위: 페이지네이션 버튼 자동화 구현 🔄
- **숫자 형태 페이지네이션 대응**: 마이리얼트립 1,2,3,4,5 버튼 구조 분석 완료
- **페이지네이션 버튼 자동 클릭**: 1→2→3...→18페이지 순차 이동
- **전체 상품 수집**: 18페이지 × 423개 상품 자동 수집
- **Products + Offers URL 통합 처리**: 두 타입 모두 지원
- **안정성 보장**: 브라우저 재부팅 + 데이터 연속성 시스템 활용
- **번호 연속성 문제 해결**: CSV 번호와 이미지 파일명 일치시키기

### 6순위: 성능 최적화 및 확장성 개선 (예정)
- 멀티 스레드 처리 시스템
- 다중 도시 병렬 크롤링
- 메모리 사용량 최적화
- 크롤링 속도 개선

## 📁 주요 파일 구조

```
test_folder/
├── test_6.ipynb           # 백업 파일 (검증 완료된 안정 버전)
├── test_7.ipynb           # 메인 작업 파일 (4개 셀 구조)
├── config/                # 상태 관리 폴더 ✅
│   ├── crawler_meta.json  # 크롤링 메타데이터
│   └── completed_urls.log # 완료된 URL 목록
├── data/                  # 계층 구조 데이터 폴더
│   └── {대륙}/{국가}/{도시}/
├── myrealtripthumb_img/   # 이미지 저장 폴더
├── levelup.txt           # 2단계 개발 계획
├── 클로드코드 공유.txt      # 로드맵 상세
└── 그룹 3 4 임무설정.txt   # 역할 분담 전략
```

## 🔧 현재 시스템 설정

- **검색 도시**: 푸켓
- **크롤링 개수**: 2개 상품 (테스트용)
- **지원 도시**: 116개 도시
- **셀 구조**: 4개 셀 (그룹 1-4)

## 💡 다음 세션 시작 방법

```bash
# 다음 Claude Code 세션에서는 이렇게 시작하세요:
# "README.md 읽고 4순위 작업부터 이어서 진행해줘"
```

## 🏗️ 기술 스택

- **언어**: Python
- **라이브러리**: Selenium, Pandas, undetected-chromedriver
- **저장**: CSV, JSON, 이미지 파일
- **구조**: Jupyter Notebook (4셀 구조)

## 📝 작업 기록

### 2025-07-20 (데이터 연속성 완전 해결) 🎉
- ✅ **이미지 폴더 초기화 문제 해결**: 그룹 2 `shutil.rmtree` 주석 처리
- ✅ **CSV 데이터 연속성 확보**: `save_batch_data()` 추가 방식으로 변경  
- ✅ **이미지 파일명 중복 방지**: `download_image()` 함수 근본적 개선
- ✅ **브라우저 재부팅 시 연속성 보장**: 전역 이미지 번호 시스템 구현
- ✅ **Windows 경로 처리 개선**: `os.path.join()` 사용
- ✅ **세션 간 데이터 보존**: HKT_001.jpg → HKT_002.jpg → HKT_003.jpg 연속 번호
- ✅ **완전한 데이터 연속성**: 새 세션에서도 기존 이미지 덮어쓰기 방지

### 2025-07-19 (기본 시스템 구축)
- ✅ 1순위 작업 완료: 상태 관리 시스템 구축
- ✅ 2순위 작업 완료: 그룹 3 정찰 단계 강화  
- ✅ 3순위 작업 완료: 그룹 4 상태 관리 시스템 적용
- ✅ 정찰 기능 실제 테스트: 푸켓 423개 상품 발견
- ✅ 페이지네이션 방식 확인 및 전략 수정
- ✅ 브라우저 재부팅 기능 구현 및 테스트 완료

### 다음 예정
- 🔄 5순위: 페이지네이션 버튼 자동화 구현 + 번호 연속성 해결
- 📋 6순위: 성능 최적화 및 확장성 개선

### 📋 그룹별 수정 현황

**✅ 그룹 1 (함수 정의)**: 
- 상태 관리 시스템 5개 함수 추가 완료
- 기존 핵심 함수들 모두 정상 작동
- 116개 도시 지원 시스템 완비

**✅ 그룹 2 (드라이버 + 검색)**: 
- 수정 없음 (이미 완벽하게 작동)
- 드라이버 실행 + 푸켓 검색 성공 확인

**✅ 그룹 3 (URL 수집 + 정찰)**: 
- 기존 URL 수집 기능 유지 (24개 수집 성공)
- **신규 추가**: 별도 셀에 정찰 강화 기능 5개
- 실제 테스트 완료: 푸켓 페이지 분석 성공

**✅ 그룹 4 (데이터 수집)**: 
- 상태 관리 시스템 완전 적용 완료
- URL 중복 체크 및 배치 처리 구현
- 실시간 상태 저장 및 재시작 기능 완비
- 오류 처리 강화 및 계층 구조 저장
- **브라우저 재부팅 기능 추가**: 안전성 극대화
- **실행 테스트 완료**: 푸켓 2개 상품 성공 수집

### 중요 발견사항 (수정됨)
- 마이리얼트립은 **점(dot) 형태 페이지네이션 버튼** 사용
- 무한 스크롤이 아닌 **버튼 클릭으로 페이지 이동** 방식
- 한 페이지당 24개, 마지막 페이지는 가변적 (24개 이하)
- 4순위: 페이지네이션 버튼 자동화로 전체 상품 수집 필요

## 🔧 현재 개발 상태

### 완성된 시스템
- ✅ **상태 관리 시스템**: 중단/재시작 가능한 크롤링
- ✅ **브라우저 재부팅**: 10-15개마다 안전한 재시작
- ✅ **배치 처리**: 효율적인 I/O 및 데이터 저장
- ✅ **계층 구조 저장**: 체계적인 데이터 관리
- ✅ **URL 중복 체크**: 무한 재시도 방지
- ✅ **실행 검증**: 푸켓 2개 상품 성공 수집

### 수집 성능
- **실제 테스트**: 2개 상품 완전 수집
- **상품 정보**: 피피섬 투어(52,000원), 푸켓 시티투어(22,000원)
- **이미지**: 계층 구조로 정상 저장 (HKT_001.jpg, HKT_003.jpg)
- **데이터**: CSV 파일 2개 생성 (도시별, 국가별)

---
**Last Updated**: 2025-07-21 00:05
**Status**: 1,2,3,4순위 작업 완료, 5순위 작업 대기중 (페이지네이션 버튼 자동화 + 번호 연속성 해결)
**Critical Achievement**: 🎉 **브라우저 재부팅 시스템 검증 완료** - 오류 복구, 페이지 복귀, 다중 도시 테스트 성공
**Current Issue**: ⚠️ CSV 번호와 이미지 파일명이 홀수로 건너뛰는 문제 (1,3,5,7...)
**Next Session**: "README.md 읽고 5순위 페이지네이션 자동화 + 번호 연속성 문제 해결부터 시작해줘"